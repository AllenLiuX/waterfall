"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}!function(t,e){"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.export?module.exports=e:t.waterfall=e}(window,function(t){var o,s,c,d,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=e.direction||"vertical",u=e.spacing||20,i=e.baseWidth||350,f=e.height||260,r=e.datas||null,h=e.bgColor||"#CCCCCC",y=e.parentBox?document.querySelector(e.parentBox):window,l=function(){var e="";r.forEach(function(t){e+='\n                <div class="fall-item" '+(t.color?"data-color='"+t.color+"'":"")+' style="height: 100%;" >\n                    <img data-width="'+t.width+'" data-height="'+t.height+'" data-src="'+t.url+'" />\n                </div>\n            '}),o.innerHTML=e},g=function(t){return t+"px"},a=function(){var l=o.clientWidth,a=0,c={height:f,children:[]};d=[],o.innerHTML="";var h=function(){d.push(c),a=0,c={height:f,children:[]}};s.forEach(function(t,e){var n=t.querySelector("img"),r=f/n.dataset.height*n.dataset.width;if(n.style.height="100%",0<c.children.length&&(r+=u,t.style.marginLeft=u+"px"),l<a+r){var o=function(n){var t=Array.from(arguments).splice(1,arguments.length),r=n,o=n;return t.forEach(function(t){var e=Math.abs(t-n);e<o&&(o=e,r=t)}),r}(l,a,a+r),i=l/o;if(c.height=f*i,o===a)return void h()}a+=r,c.children.push(t),e>=s.length-1&&h()}),d.forEach(function(t,e){var n=document.createElement("div");n.style.display="flex",n.style.height=t.height+"px",e<d.length-1&&(n.style.justifyContent="space-between",n.style.marginBottom=u+"px"),n.append.apply(n,_toConsumableArray(t.children)),o.appendChild(n)})},p=function(){"horizontal"===n?a():function(){console.log("====");var t=o.clientWidth,e=Math.floor((t+u)/(i+u));e<1&&(e=1);var a=(t+u)/e-u;s.length<e&&(e=s.length,a=(t+u)/e-u),d={};for(var n=0;n<e;n++)d[n]=0;s.forEach(function(t){var e=t.querySelector("img"),n=t.dataset.color||h,r=e.dataset.width,o=e.dataset.height*(a/r);0<=n.indexOf("0x")&&(n="#"+n.substring(n.length-6));var i=function(t){var e=0;for(var n in t)t[n]<t[e]&&(e=n);return e}(d),l=d[i]||0;e.style.width="100%",e.style.maxWidth="100%",t.style.position="absolute",t.style.top=g(l),t.style.left=g((a+u)*i),t.style.width=g(a),t.style.height=g(o),t.style.backgroundColor=n,d[i]=l+o+u});var r=function(t){var e=0;for(var n in t)t[n]>t[e]&&(e=n);return e}(d);o.style.height=g(d[r]),console.log(d),console.log(y.innerHeight||y.clientHeight)}()},v=function t(){if(c.length<1)return y.removeEventListener("scroll",t);for(var e=c.length;e--;)l=c[e],void 0,a=l.getBoundingClientRect().top,(y.innerHeight?a<=y.innerHeight:a<=y.clientHeight+y.getBoundingClientRect().top)&&(n=c[e],r=e,o=void 0,o=n.querySelector("img"),i=o.dataset.src,o.src=i,c.splice(r,1));var n,r,o,i,l,a};t&&"string"==typeof t&&(o=document.querySelector(t),r&&0<r.length&&(o.innerHTML="",l()),s=Array.from(o.children),c=s.concat(),s.length&&(s.forEach(function(t){t.querySelector("img").style.display="block"}),o.style.position="relative",window.addEventListener("resize",p),y.addEventListener("scroll",v),p(),v()))});